chrome.runtime.onMessage.addListener((t,o,c)=>(m(t,c),!0));async function m(t,o){try{switch(t.type){case"DETECT_JD":const c=y(),n=h();o({success:!0,data:{jd:c,...n}});break;case"FILL_FORM":await j(t.data),o({success:!0});break;case"GET_FORM_FIELDS":const s=g();o({success:!0,data:s});break;case"PING":o({success:!0,data:"pong"});break;default:o({success:!1,error:"Unknown message type"})}}catch(c){o({success:!1,error:c.message})}}function y(){const t=['[class*="job-description"]','[class*="job_description"]','[class*="jobDescription"]','[id*="job-description"]','[id*="job_description"]','[data-testid*="description"]','[data-automation-id="jobPostingDescription"]',".job-posting-section","#content .job-description",".job-content",".posting-headline",".content",".description__text",".jobs-description",".job-view-layout","#jobDescriptionText",".jobsearch-jobDescriptionText",".desc",".eeOeq",'[role="main"]',"main","article"];for(const n of t){const s=document.querySelector(n);if(s&&s.textContent&&s.textContent.length>200)return a(s.textContent)}const o=document.querySelectorAll("p, div");let c="";for(const n of o){const s=n.textContent||"";s.length>c.length&&s.length>500&&(c=s)}return a(c)}function h(){let t="",o="";const c=["h1",'[class*="job-title"]','[class*="jobTitle"]','[data-testid*="title"]',".posting-headline h2",".jobs-details-top-card__job-title"];for(const s of c){const e=document.querySelector(s);if(e&&e.textContent&&e.textContent.length>2&&e.textContent.length<100){t=a(e.textContent);break}}const n=['[class*="company-name"]','[class*="companyName"]','[class*="company_name"]','[data-testid*="company"]',".posting-categories .company",".jobs-details-top-card__company-url",".employer-name"];for(const s of n){const e=document.querySelector(s);if(e&&e.textContent&&e.textContent.length>1&&e.textContent.length<100){o=a(e.textContent);break}}if(!t||!o){const e=document.title.match(/^(.+?)\s+(?:at|@|-|–|—|\|)\s+(.+?)(?:\s+[-|]|$)/i);e&&(t||(t=e[1].trim()),o||(o=e[2].trim()))}return{jobTitle:t,company:o}}function g(){const t=[],o=document.querySelectorAll("input, textarea, select");for(const c of o){const n=c;if(n.type==="hidden"||n.type==="submit"||n.type==="button")continue;let s="";const e=document.querySelector(`label[for="${n.id}"]`);if(e)s=e.textContent||"";else{const l=n.closest("div, fieldset, label");if(l){const i=l.querySelector("label, span, div");i&&i!==n&&(s=i.textContent||"")}}t.push({name:n.name||n.id||"",type:n.tagName.toLowerCase()+(n.type?`-${n.type}`:""),label:a(s).slice(0,100),value:n.value||""})}return t}async function j(t){var n;const o={firstName:["first_name","firstname","fname","first-name","given"],lastName:["last_name","lastname","lname","last-name","surname","family"],email:["email","e-mail","emailaddress"],phone:["phone","telephone","tel","mobile","cell"],linkedin:["linkedin","linked-in","linked_in"],github:["github","git-hub"],portfolio:["portfolio","website","url","personal"],coverLetter:["cover","letter","coverletter","cover_letter"]},c=document.querySelectorAll("input, textarea");for(const s of c){const e=s;if(e.type==="hidden"||e.type==="submit")continue;const l=(e.name+e.id+e.placeholder+e.className).toLowerCase();for(const[d,f]of Object.entries(o)){const r=t[d];if(r){for(const u of f)if(l.includes(u)){await p(e,r);break}}}const i=document.querySelector(`label[for="${e.id}"]`);if(i){const d=((n=i.textContent)==null?void 0:n.toLowerCase())||"";for(const[f,r]of Object.entries(o)){const u=t[f];if(u){for(const b of r)if(d.includes(b)){await p(e,u);break}}}}}}async function p(t,o){t.value||(t.focus(),t.value=o,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})),await new Promise(c=>setTimeout(c,50)))}function a(t){return t.replace(/\s+/g," ").replace(/\n+/g,`
`).trim()}console.log("CV-Tailor content script loaded");
