chrome.runtime.onMessage.addListener((t,l,i)=>(console.log("[CV-Tailor] Received message:",t.type),g(t,i),!0));async function g(t,l){try{switch(t.type){case"DETECT_JD":const i=y(),o=h();console.log("[CV-Tailor] Detected JD length:",i.length,"Job:",o),l({success:!0,data:{jd:i,...o}});break;case"FILL_FORM":console.log("[CV-Tailor] Filling form with data:",Object.keys(t.data));const n=await C(t.data);console.log("[CV-Tailor] Filled",n,"fields"),l({success:!0,data:{filledCount:n}});break;case"GET_FORM_FIELDS":const e=v();l({success:!0,data:e});break;case"PING":l({success:!0,data:"pong"});break;default:l({success:!1,error:"Unknown message type"})}}catch(i){console.error("[CV-Tailor] Error:",i),l({success:!1,error:i.message})}}function y(){const t=['[class*="job-description"]','[class*="job_description"]','[class*="jobDescription"]','[id*="job-description"]','[id*="job_description"]','[data-testid*="description"]','[data-automation-id="jobPostingDescription"]',".job-posting-section","#content .job-description",".job-content",".posting-headline",".content",".description__text",".jobs-description",".job-view-layout",".jobs-description-content__text","#jobDescriptionText",".jobsearch-jobDescriptionText",".desc",".eeOeq",'[role="main"]',"main","article"];for(const o of t){const n=document.querySelector(o);if(n&&n.textContent&&n.textContent.length>200)return c(n.textContent)}const l=document.querySelectorAll("p, div");let i="";for(const o of l){const n=o.textContent||"";n.length>i.length&&n.length>500&&(i=n)}return c(i)}function h(){let t="",l="";const i=["h1",'[class*="job-title"]','[class*="jobTitle"]','[data-testid*="title"]',".posting-headline h2",".jobs-details-top-card__job-title",".top-card-layout__title"];for(const n of i){const e=document.querySelector(n);if(e&&e.textContent&&e.textContent.length>2&&e.textContent.length<100){t=c(e.textContent);break}}const o=['[class*="company-name"]','[class*="companyName"]','[class*="company_name"]','[data-testid*="company"]',".posting-categories .company",".jobs-details-top-card__company-url",".employer-name",".top-card-layout__second-subline"];for(const n of o){const e=document.querySelector(n);if(e&&e.textContent&&e.textContent.length>1&&e.textContent.length<100){l=c(e.textContent);break}}if(!t||!l){const e=document.title.match(/^(.+?)\s+(?:at|@|-|–|—|\|)\s+(.+?)(?:\s+[-|]|$)/i);e&&(t||(t=e[1].trim()),l||(l=e[2].trim()))}return{jobTitle:t,company:l}}function v(){const t=[],l=document.querySelectorAll("input, textarea, select");for(const i of l){const o=i;if(o.type==="hidden"||o.type==="submit"||o.type==="button")continue;let n="";const e=document.querySelector(`label[for="${o.id}"]`);if(e)n=e.textContent||"";else{const s=o.closest("div, fieldset, label");if(s){const a=s.querySelector("label, span, div");a&&a!==o&&(n=a.textContent||"")}}t.push({name:o.name||o.id||"",type:o.tagName.toLowerCase()+(o.type?`-${o.type}`:""),label:c(n).slice(0,100),value:o.value||""})}return t}async function C(t){const l={firstName:["first_name","firstname","fname","first-name","given","first name","givenname"],lastName:["last_name","lastname","lname","last-name","surname","family","last name","familyname"],email:["email","e-mail","emailaddress","e_mail","mail"],phone:["phone","telephone","tel","mobile","cell","phonenumber","phone number"],linkedin:["linkedin","linked-in","linked_in","linkedinurl"],github:["github","git-hub","githuburl"],portfolio:["portfolio","website","url","personal","personalwebsite","personalurl","web"],coverLetter:["cover","letter","coverletter","cover_letter","cover letter","motivation"]};let i=0;const o=document.querySelectorAll("input, textarea");console.log("[CV-Tailor] Found",o.length,"input fields");for(const n of o){const e=n;if(e.type==="hidden"||e.type==="submit"||e.type==="file"||e.type==="checkbox"||e.type==="radio")continue;const s=[e.name,e.id,e.placeholder,e.className,e.getAttribute("aria-label"),e.getAttribute("data-testid")].filter(Boolean).join(" ").toLowerCase();let a="";const d=document.querySelector(`label[for="${e.id}"]`);if(d)a=(d.textContent||"").toLowerCase();else{const r=e.closest("div, fieldset, label, section");if(r){const u=r.querySelector("label, span.label, div.label");u&&(a=(u.textContent||"").toLowerCase())}}const f=s+" "+a;let p=!1;for(const[r,u]of Object.entries(l)){if(p)break;const b=t[r];if(b){for(const m of u)if(f.includes(m)){console.log("[CV-Tailor] Filling field:",e.name||e.id,"with",r),await x(e,b),i++,p=!0;break}}}}return i}async function x(t,l){var n,e;if(t.value&&t.value.trim()){console.log("[CV-Tailor] Skipping field (has value):",t.name||t.id);return}t.focus(),t.value="";const i=(n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))==null?void 0:n.set,o=(e=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))==null?void 0:e.set;t instanceof HTMLInputElement&&i?i.call(t,l):t instanceof HTMLTextAreaElement&&o?o.call(t,l):t.value=l,t.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),t.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),t.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0})),t.dispatchEvent(new Event("blur",{bubbles:!0})),await new Promise(s=>setTimeout(s,100))}function c(t){return t.replace(/\s+/g," ").replace(/\n+/g,`
`).trim()}console.log("[CV-Tailor] Content script loaded on:",window.location.hostname);
